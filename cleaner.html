<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–°–∏—Å—Ç–µ–º–Ω–∏–π –û—á–∏—Å–Ω–∏–∫ | Smart Market</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <style>
        /* –ë–ê–ì–ê–¢–ò–ô –û–ö–°–ê–ú–ò–¢–û–í–ò–ô –°–¢–ò–õ–¨ */
        :root { 
            --bg: #0d0f12; 
            --panel: #14171c; 
            --olive: #6b873b; 
            --olive-dark: #465926; 
            --danger: #992828; 
            --danger-dark: #661818; 
            --text: #e5e7eb; 
        }
        
        body { 
            background: var(--bg); 
            color: var(--text); 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            padding: 0; 
            margin: 0; 
            text-align: center; 
            font-size: 16px; 
            padding-bottom: 40px;
        }
        
        /* –ù–ê–í–Ü–ì–ê–¶–Ü–Ø */
        .system-nav { 
            background: rgba(13, 15, 18, 0.95); 
            padding: 15px 10px; 
            display: flex; 
            flex-wrap: wrap;
            justify-content: center; 
            gap: 10px; 
            border-bottom: 1px solid #2a2e35; 
            margin-bottom: 30px; 
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .sys-btn { 
            text-decoration: none; 
            color: #aaa; 
            font-size: 15px; 
            font-weight: 600;
            padding: 10px 16px; 
            border-radius: 12px; 
            border: 1.5px solid #333; 
            background: var(--panel);
            transition: 0.2s; 
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .sys-btn:hover { border-color: #555; color: #fff; }
        .sys-btn.active { background: var(--danger-dark); color: #fff; border-color: var(--danger); box-shadow: 0 0 10px rgba(153, 40, 40, 0.3); }
        .sys-btn.dashboard { border-color: var(--olive); color: #fff; }
        .sys-btn.dashboard:active { background: rgba(107, 135, 59, 0.1); }

        /* –ì–û–õ–û–í–ù–ê –ü–ê–ù–ï–õ–¨ */
        .panel { 
            background: var(--panel); 
            padding: 30px 20px; 
            border-radius: 20px; 
            border: 1px solid #2a2e35; 
            max-width: 600px; 
            margin: 0 auto; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.6); 
            box-sizing: border-box;
        }
        
        .title-icon { font-size: 40px; margin-bottom: 10px; }
        .panel h2 { color: #d9534f; margin-top: 0; font-size: 24px; letter-spacing: 1px; }
        .panel p { color: #888; margin-bottom: 30px; font-size: 16px; line-height: 1.5; }
        
        /* –û–ë'–Ñ–ú–ù–Ü –ö–ù–û–ü–ö–ò */
        .btn { 
            padding: 16px; 
            border: none; 
            width: 100%; 
            border-radius: 12px; 
            font-weight: bold; 
            cursor: pointer; 
            margin-bottom: 15px; 
            font-size: 16px; 
            text-transform: uppercase; 
            letter-spacing: 0.5px;
            color: #fff; 
            transition: 0.1s; 
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-nuke { 
            background: linear-gradient(180deg, var(--danger) 0%, var(--danger-dark) 100%); 
            box-shadow: 0 5px 0 #4a1010; 
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        .btn-nuke:active { transform: translateY(5px); box-shadow: none; }
        
        .btn-soft { 
            background: linear-gradient(180deg, #3a3f48 0%, #2a2e35 100%); 
            border: 1px solid #444; 
            box-shadow: 0 4px 0 #1a1c20; 
            color: #ccc;
        }
        .btn-soft:active { transform: translateY(4px); box-shadow: none; }

        /* –¢–ï–†–ú–Ü–ù–ê–õ / –õ–û–ì */
        #log { 
            margin-top: 25px; 
            background: #080a0c; 
            padding: 18px; 
            border-radius: 12px; 
            color: #d9534f; 
            text-align: left; 
            height: 220px; 
            font-family: 'Courier New', Courier, monospace; 
            overflow-y: auto; 
            font-size: 15px; /* –ö–æ–º—Ñ–æ—Ä—Ç–Ω–∏–π —Å–µ—Ä–µ–¥–Ω—ñ–π —Ä–æ–∑–º—ñ—Ä –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è */
            border: 1px solid #2a2e35; 
            line-height: 1.6;
            box-shadow: inset 0 5px 15px rgba(0,0,0,0.5);
        }
        .log-success { color: var(--olive); font-weight: bold; }
        .log-info { color: #aaa; }
    </style>
</head>
<body>

    <div class="system-nav">
        <a href="dashboard.html" class="sys-btn dashboard">üîë –í –ö–∞–±—ñ–Ω–µ—Ç</a>
        <a href="index.html" class="sys-btn">üõçÔ∏è –í—ñ—Ç—Ä–∏–Ω–∞</a>
        <a href="scout_mta.html" class="sys-btn">üïµÔ∏è –†–æ–∑–≤—ñ–¥–Ω–∏–∫</a>
        <a href="agent_ai.html" class="sys-btn">ü§ñ AI –ê–≥–µ–Ω—Ç</a>
        <a href="cleaner.html" class="sys-btn active">üóëÔ∏è –û—á–∏—Å–Ω–∏–∫</a>
    </div>

    <div class="panel">
        <div class="title-icon">‚ò¢Ô∏è</div>
        <h2>–°–ò–°–¢–ï–ú–ù–ò–ô –û–ß–ò–°–ù–ò–ö</h2>
        <p>–ö–µ—Ä—É–≤–∞–Ω–Ω—è –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö Supabase. –ë—É–¥—å—Ç–µ –æ–±–µ—Ä–µ–∂–Ω—ñ, —Ü—ñ –¥—ñ—ó –Ω–µ–º–æ–∂–ª–∏–≤–æ —Å–∫–∞—Å—É–≤–∞—Ç–∏.</p>
        
        <button class="btn btn-nuke" onclick="nukeAll()">–í–ò–¢–ï–†–¢–ò –í–°–Ü –¢–û–í–ê–†–ò –¢–ê –û–ü–ò–°–ò</button>
        <button class="btn btn-soft" onclick="cleanUnprocessed()">üßπ –í–∏–¥–∞–ª–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –Ω–µ–æ–±—Ä–æ–±–ª–µ–Ω—ñ (–±–µ–∑ –®–Ü)</button>
        
        <div id="log"><span class="log-info">> –°–∏—Å—Ç–µ–º–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–∞ —Ç–∞ –≥–æ—Ç–æ–≤–∞ –¥–æ —Ä–æ–±–æ—Ç–∏...</span></div>
    </div>

    <script>
        const sb = supabase.createClient(CONFIG.SB_URL, CONFIG.SB_KEY);
        const log = document.getElementById('log');

        function addLog(message, type = 'error') {
            const time = new Date().toLocaleTimeString('uk-UA');
            let colorClass = '';
            if (type === 'success') colorClass = 'log-success';
            if (type === 'info') colorClass = 'log-info';
            
            log.innerHTML += `<br><span class="${colorClass}">[${time}] ${message}</span>`;
            log.scrollTop = log.scrollHeight;
        }

        async function nukeAll() {
            if(!confirm("‚ö†Ô∏è –£–í–ê–ì–ê: –û–ß–ò–°–¢–ò–¢–ò –í–°–Æ –ë–ê–ó–£?\n\n–¶–µ –±–µ–∑–ø–æ–≤–æ—Ä–æ—Ç–Ω–æ –≤–∏–¥–∞–ª–∏—Ç—å —É—Å—ñ —Ç–æ–≤–∞—Ä–∏ —Ç–∞ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ –®–Ü –æ–ø–∏—Å–∏ –∑ –≤—ñ—Ç—Ä–∏–Ω–∏. –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏?")) return;
            
            addLog("> –ü–æ—á–∞—Ç–æ–∫ –ø–æ–≤–Ω–æ—ó –∑–∞—á–∏—Å—Ç–∫–∏ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö...", "info");

            // –í–∏–¥–∞–ª—è—î–º–æ –≤—Å—ñ –∑–∞–ø–∏—Å–∏ –∑ —Ç–∞–±–ª–∏—Ü—ñ –æ–ø–∏—Å—ñ–≤
            const { error: err1 } = await sb.from('ai_content').delete().neq('fancy_description', 'FORCED_DELETE_ALL');
            
            // –í–∏–¥–∞–ª—è—î–º–æ –≤—Å—ñ –∑–∞–ø–∏—Å–∏ –∑ —Ç–∞–±–ª–∏—Ü—ñ —Ç–æ–≤–∞—Ä—ñ–≤
            const { error: err2 } = await sb.from('products').delete().neq('title', 'FORCED_DELETE_ALL');
            
            if(err1 || err2) {
                addLog(`‚ùå –ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è: ${err2?.message || err1?.message}`, "error");
            } else {
                addLog("‚úÖ –ë–ê–ó–ê –ü–û–í–ù–Ü–°–¢–Æ –û–ß–ò–©–ï–ù–ê. –í—Å—ñ –¥–∞–Ω—ñ –≤–∏–¥–∞–ª–µ–Ω–æ.", "success");
            }
        }

        async function cleanUnprocessed() {
            if(!confirm("–í–∏–¥–∞–ª–∏—Ç–∏ –∑ –±–∞–∑–∏ –≤—Å—ñ —Ç–æ–≤–∞—Ä–∏, –¥–ª—è —è–∫–∏—Ö —â–µ –Ω–µ —Å—Ç–≤–æ—Ä–µ–Ω–æ –®–Ü-–æ–ø–∏—Å?")) return;
            
            addLog("> –®—É–∫–∞—é —Ç–∞ –≤–∏–¥–∞–ª—è—é –Ω–µ–æ–±—Ä–æ–±–ª–µ–Ω—ñ —Ç–æ–≤–∞—Ä–∏...", "info");
            
            const { error } = await sb.from('products').delete().eq('is_processed_ai', false);
            
            if(error) {
                addLog(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, "error");
            } else {
                addLog("‚úÖ –ù–µ–æ–±—Ä–æ–±–ª–µ–Ω—ñ —Ç–æ–≤–∞—Ä–∏ —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω—ñ –∑ –±–∞–∑–∏.", "success");
            }
        }
    </script>
</body>
</html>
