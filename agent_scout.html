<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scout: Money Engine</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <style>
        :root { --bg: #0d1117; --accent: #58a6ff; --text: #ffffff; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        .panel { background: #161b22; padding: 30px; border-radius: 15px; border: 3px solid var(--accent); width: 100%; max-width: 500px; }
        
        label { font-size: 22px; font-weight: bold; margin-bottom: 10px; display: block; color: var(--accent); }
        input, select { 
            width: 100%; padding: 20px; background: #000; border: 2px solid #444; 
            color: #fff; border-radius: 12px; margin-bottom: 25px; font-size: 22px; 
            box-sizing: border-box;
        }

        .btn { 
            background: #238636; color: #fff; padding: 25px; border-radius: 15px; 
            border: none; cursor: pointer; width: 100%; font-weight: bold; font-size: 26px;
        }
        
        #log { margin-top: 30px; width: 100%; max-width: 500px; color: #00ff41; font-family: monospace; font-size: 20px; }
    </style>
</head>
<body>
    <h1 style="font-size: 32px; text-align: center;">–î–û–ë–ê–í–ò–¢–¨ –í–ò–¢–†–ò–ù–£</h1>
    
    <div class="panel">
        <label>–ù–ê–ó–í–ê–ù–ò–ï –¢–û–í–ê–†–ê:</label>
        <input type="text" id="q" placeholder="–ù–∞–ø—Ä: –°–º–∞—Ä—Ç-—á–∞—Å—ã">
        
        <label>–ö–ê–¢–ï–ì–û–†–ò–Ø:</label>
        <select id="cat">
            <option value="–°–º–∞—Ä—Ç—Ñ–æ–Ω—ã">üì± –°–ú–ê–†–¢–§–û–ù–´</option>
            <option value="–ì–∞–¥–∂–µ—Ç—ã">‚åö –ì–ê–î–ñ–ï–¢–´</option>
            <option value="–ë—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞">üè† –¢–ï–•–ù–ò–ö–ê</option>
            <option value="–†–∞–∑–Ω–æ–µ">üì¶ –†–ê–ó–ù–û–ï</option>
        </select>

        <label>–¶–ï–ù–ê (–ì–†–ù):</label>
        <input type="number" id="price" placeholder="4999">

        <label>–°–°–´–õ–ö–ê –ù–ê –¢–û–í–ê–† (–û–†–ò–ì–ò–ù–ê–õ):</label>
        <input type="text" id="target_url" placeholder="https://rozetka...">

        <button class="btn" onclick="saveWithMoney()">–°–û–•–†–ê–ù–ò–¢–¨ –î–õ–Ø –ü–†–ò–ë–´–õ–ò</button>
    </div>

    <div id="log">> –ñ–¥—É –≤–≤–æ–¥–∞...</div>

    <script>
        const supabaseClient = supabase.createClient(CONFIG.SB_URL, CONFIG.SB_KEY);

        async function saveWithMoney() {
            const title = document.getElementById('q').value;
            const cat = document.getElementById('cat').value;
            const price = document.getElementById('price').value;
            const targetUrl = document.getElementById('target_url').value;
            const log = document.getElementById('log');

            if(!title || !price || !targetUrl) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");

            log.innerHTML += `<br>> –§–æ—Ä–º–∏—Ä—É—é –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫—É—é —Å—Å—ã–ª–∫—É...`;

            // –õ–û–ì–ò–ö–ê –ì–ï–ù–ï–†–ê–¶–ò–ò –î–ï–ù–ï–ñ–ù–û–ô –°–°–´–õ–ö–ò
            let moneyUrl = "";
            if(CONFIG.NETWORK === 'SalesDoubler') {
                // –§–æ—Ä–º–∞—Ç SalesDoubler DeepLink
                moneyUrl = `https://rdr.salesdoubler.com.ua/rel/t/direct/link/${CONFIG.AFFILIATE_ID}?url=${encodeURIComponent(targetUrl)}`;
            } else {
                moneyUrl = targetUrl;
            }

            log.innerHTML += `<br>> –°–æ—Ö—Ä–∞–Ω—è—é –≤ –±–∞–∑—É...`;

            const img = `https://loremflickr.com/400/400/tech?v=${Math.random()}`;
            const { data: shops } = await supabaseClient.from('shops').select('id').limit(1);

            const { error } = await supabaseClient.from('products').insert({
                title: title,
                price: parseInt(price),
                image_url: img,
                product_url: moneyUrl, // –°–û–•–†–ê–ù–Ø–ï–ú –î–ï–ù–ï–ñ–ù–£–Æ –°–°–´–õ–ö–£
                category: cat,
                shop_id: shops[0].id,
                is_processed_ai: false
            });

            if(!error) {
                log.innerHTML += `<br><span style="color:cyan">> –¢–û–í–ê–† –ì–û–¢–û–í –ö –ü–†–û–î–ê–ñ–ï!</span>`;
                document.getElementById('q').value = "";
                document.getElementById('price').value = "";
                document.getElementById('target_url').value = "";
            }
        }
    </script>
</body>
</html>
