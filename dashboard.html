<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vitrina: Big Control</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --accent: #58a6ff; --text: #ffffff; }
        
        body { 
            background: var(--bg); color: var(--text); 
            font-family: sans-serif; padding: 20px; 
            display: flex; flex-direction: column; align-items: center;
        }

        h1 { font-size: 28px; margin-bottom: 30px; text-align: center; color: var(--accent); }

        .stats-grid { 
            display: flex; flex-direction: column; gap: 20px; 
            width: 100%; max-width: 500px; margin-bottom: 30px; 
        }

        .stat-card { 
            background: var(--card); padding: 30px; border-radius: 15px; 
            border: 2px solid #30363d; text-align: center; 
        }

        /* ОЧЕНЬ КРУПНЫЕ ЦИФРЫ */
        .stat-val { font-size: 60px; font-weight: 800; color: var(--accent); display: block; }
        .stat-label { font-size: 20px; font-weight: bold; margin-top: 10px; display: block; }

        .btn-group { 
            display: flex; flex-direction: column; gap: 15px; 
            width: 100%; max-width: 500px; 
        }

        /* КРУПНЫЕ КНОПКИ */
        .btn { 
            background: #21262d; color: var(--accent); 
            padding: 25px; border-radius: 12px; 
            border: 2px solid var(--accent); 
            cursor: pointer; text-decoration: none; 
            font-weight: 800; font-size: 22px; text-align: center;
        }

        .btn-report { background: #238636; color: #fff; border: none; margin-top: 10px; }

        #report-box { 
            margin-top: 25px; background: #000; padding: 25px; 
            border-radius: 12px; border: 2px solid #00ff41; 
            width: 100%; max-width: 500px; display: none; 
            color: #00ff41; font-family: monospace; font-size: 20px; 
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <h1>УПРАВЛЕНИЕ</h1>

    <div class="stats-grid">
        <div class="stat-card">
            <span id="total" class="stat-val">0</span>
            <span class="stat-label">ТОВАРОВ В БАЗЕ</span>
        </div>
        <div class="stat-card">
            <span id="done" class="stat-val">0</span>
            <span class="stat-label">С ОПИСАНИЕМ ИИ</span>
        </div>
    </div>

    <div class="btn-group">
        <a href="index.html" class="btn">ОТКРЫТЬ ВИТРИНУ</a>
        <a href="agent_scout.html" class="btn">ЗАПУСТИТЬ РАЗВЕДЧИКА</a>
        <a href="agent_ai.html" class="btn">ЗАПУСТИТЬ ОПИСАТЕЛЯ</a>
        <button class="btn btn-report" onclick="generateReport()">ОТЧЕТ О ПРИБЫЛИ</button>
    </div>

    <div id="report-box"></div>

    <script>
        const supabaseClient = supabase.createClient(CONFIG.SB_URL, CONFIG.SB_KEY);

        async function loadStats() {
            const { count: t } = await supabaseClient.from('products').select('*', { count: 'exact', head: true });
            const { count: d } = await supabaseClient.from('products').select('*', { count: 'exact', head: true }).eq('is_processed_ai', true);
            document.getElementById('total').innerText = t || 0;
            document.getElementById('done').innerText = d || 0;
        }

        async function generateReport() {
            const box = document.getElementById('report-box');
            box.style.display = 'block';
            box.innerHTML = "> СЧИТАЮ ПРИБЫЛЬ...";

            const { data: products } = await supabaseClient.from('products').select('price');
            let totalValue = products.reduce((sum, p) => sum + p.price, 0);
            let estProfit = Math.floor(totalValue * 0.04); 

            setTimeout(() => {
                box.innerHTML = `
                    ОТЧЕТ ПО ВИТРИНЕ<br>
                    -------------------<br>
                    ТОВАРОВ: ${products.length}<br>
                    СУММА: ${totalValue.toLocaleString()} грн<br>
                    ПРИБЫЛЬ (4%): <br>
                    <b style="font-size:30px">${estProfit.toLocaleString()} грн</b><br>
                    -------------------
                `;
            }, 800);
        }

        loadStats();
    </script>
</body>
</html>
